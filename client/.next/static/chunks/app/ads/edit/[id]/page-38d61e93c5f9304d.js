(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[254],{712:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var s=r(5155),a=r(2115),l=r(5695),o=r(4937),n=r(1063),i=r(8941),c=r(8093);function d(){let e=(0,l.useRouter)(),{id:t}=(0,l.useParams)(),[r,d]=(0,a.useState)(""),[u,m]=(0,a.useState)(""),[h,p]=(0,a.useState)(""),[x,g]=(0,a.useState)(1),[b,f]=(0,a.useState)(null),[j,v]=(0,a.useState)([]),[N,y]=(0,a.useState)({}),[S,A]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let r=async()=>{let e=await (0,i.F)("".concat(o.A.API_URL).concat(n.A.ADS,"/").concat(t),"GET");if(e instanceof Response&&e.status<400){let t=(await e.json()).ad;d(t.title),m(t.description),p(t.location),g(t.price),f(t.sub_category_id)}else console.error("Error fetching ad:",e)},s=async()=>{let e=await (0,i.F)(o.A.API_URL+n.A.SUB_CATEGORIES,"GET");e instanceof Response?v((await e.json()).subCategories):console.error("Error fetching subcategories:",e)};(async()=>{let t=JSON.parse(localStorage.getItem("user")||"{}");if(!(null==t?void 0:t.token)||(null==t?void 0:t.role)!=="admin")return e.push("/");await s(),await r(),A(!1)})()},[t]);let w=async s=>{s.preventDefault();try{let s=await (0,i.F)("".concat(o.A.API_URL).concat(n.A.ADS,"/").concat(t),"PUT",{title:r,description:u,location:h,price:x,sub_category_id:b});if(s instanceof Response&&s.ok)alert("Ad updated successfully!"),e.push("/");else{let e=s instanceof Response?await s.json():null;if(e.errors&&Array.isArray(e.errors)){let t={};e.errors.forEach(e=>{"object"==typeof e&&null!==e&&"path"in e&&"msg"in e&&(t[e.path]=e.msg)}),y(t)}else alert("Failed to create ad.")}}catch(e){console.error("Error updating ad:",e)}};return S?(0,s.jsx)("p",{className:"text-center p-8",children:"loading..."}):(0,s.jsxs)("div",{children:[(0,s.jsx)(c.A,{}),(0,s.jsxs)("div",{className:"max-w-2xl mx-auto p-8",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Edit Ad"}),(0,s.jsxs)("form",{className:"flex flex-col gap-4",onSubmit:w,children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{htmlFor:"title",className:"mb-1 font-semibold",children:"Title"}),(0,s.jsx)("input",{id:"title",type:"text",className:"border p-2 rounded",placeholder:"Enter ad title",value:r,onChange:e=>d(e.target.value),required:!0})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{htmlFor:"description",className:"mb-1 font-semibold",children:"Description"}),(0,s.jsx)("textarea",{id:"description",className:"border p-2 rounded",placeholder:"Enter ad description",value:u,onChange:e=>m(e.target.value),required:!0})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{htmlFor:"location",className:"mb-1 font-semibold",children:"Location"}),(0,s.jsx)("input",{id:"location",type:"text",className:"border p-2 rounded",placeholder:"Enter location",value:h,onChange:e=>p(e.target.value)})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{htmlFor:"price",className:"mb-1 font-semibold",children:"Price"}),(0,s.jsx)("input",{min:1,id:"price",type:"number",className:"border p-2 rounded",placeholder:"Enter price",value:x,onChange:e=>g(Number(e.target.value)),required:!0})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{htmlFor:"subCategory",className:"mb-1 font-semibold",children:"Sub-Category"}),(0,s.jsxs)("select",{id:"subCategory",className:"border p-2 rounded",value:null!=b?b:"",onChange:e=>f(Number(e.target.value)),required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select Sub-Category"}),j&&j.length>0&&j.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),N.price&&(0,s.jsx)("p",{className:"text-red-500 text-sm mt-1",children:N.price}),(0,s.jsx)("button",{type:"submit",className:"bg-green-600 text-white p-2 rounded mt-4",children:"Update Ad"})]})]})]})}},1063:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s={ME:"/me",ADS:"/ads",LOGIN:"/login",MY_ADS:"/my-ads",SUB_CATEGORIES:"/sub-categories",ADMIN_GET_ALL_ADS:"/admin-get-all-ads",UPDATE_AD_STATUS:"/update-ad-status",REGISTER:"/register"}},4937:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s={API_URL:"http://13.48.5.152:8080/api"}},5675:(e,t,r)=>{Promise.resolve().then(r.bind(r,712))},5695:(e,t,r)=>{"use strict";var s=r(8999);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},8093:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var s=r(5155),a=r(2115),l=r(5695),o=r(4937),n=r(1063),i=r(8941);function c(){let[e,t]=(0,a.useState)(null),[r,c]=(0,a.useState)(!0),d=(0,l.useRouter)();return(0,a.useEffect)(()=>{(async()=>{let e=localStorage.getItem("user");if(e){t(JSON.parse(e)),c(!1);return}if(!localStorage.getItem("token"))return c(!1);try{let e=await (0,i.F)(o.A.API_URL+n.A.ME,"POST");if(e instanceof Response&&e.ok){let r=await e.json();t(r.user),localStorage.setItem("user",JSON.stringify(r.user))}else localStorage.removeItem("token"),localStorage.removeItem("user")}catch(e){console.error("Failed to fetch user data:",e)}finally{c(!1)}})()},[]),(0,s.jsxs)("nav",{className:"sticky top-0 w-full bg-white shadow-md p-4 flex justify-between items-center",children:[(0,s.jsx)("div",{className:"text-xl font-bold text-blue-600 cursor-pointer",onClick:()=>d.push("/"),children:"Dubizzle"}),(0,s.jsx)("div",{className:"flex gap-4 items-center",children:r?(0,s.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"}):e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("span",{className:"text-gray-700",children:["Welcome, ",(0,s.jsx)("span",{className:"font-semibold",children:e.username}),"!"]}),"admin"===e.role&&(0,s.jsx)("button",{onClick:()=>{d.push("/admin")},className:"px-4 py-2 cursor-pointer bg-blue-500 hover:bg-blue-600 text-white rounded transition",children:"Dashboard"}),(0,s.jsx)("button",{onClick:()=>{d.push("/profile")},className:"px-4 py-2 cursor-pointer bg-yellow-500 hover:bg-yellow-600 text-white rounded transition",children:"Profile"}),(0,s.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),t(null),d.refresh()},className:"px-4 py-2 cursor-pointer bg-red-500 hover:bg-red-600 text-white rounded transition",children:"Logout"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("a",{href:"/register",className:"px-4 cursor-pointer py-2 bg-blue-500 hover:bg-blue-600 text-white rounded transition",children:"Register"}),(0,s.jsx)("a",{href:"/login",className:"px-4 py-2 cursor-pointer bg-green-500 hover:bg-green-600 text-white rounded transition",children:"Login"})]})})]})}},8941:(e,t,r)=>{"use strict";r.d(t,{F:()=>s});let s=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{console.debug("fetchData debug",e,t);let s={Accept:"application/json"},a=localStorage.getItem("token");a&&(s.Authorization="Bearer ".concat(a));let l={method:t,headers:s};"GET"!==t&&(r instanceof FormData?(delete s["Content-Type"],l.body=r):(s["Content-Type"]="application/json",l.body=JSON.stringify(r)));let o=await fetch(e,l);if(401===o.status)return console.warn("Token expired or invalid. Redirecting to login..."),localStorage.removeItem("token"),window.location.href="/login",Error("Unauthorized. Redirecting to login.");return o}catch(e){return console.error("Error: fetchData",e),e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(5675)),_N_E=e.O()}]);